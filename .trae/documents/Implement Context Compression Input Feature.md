# 上下文压缩输入功能实现方案

本方案旨在为 AI 测试平台添加独立的“上下文压缩”功能。这将允许用户输入长文本上下文，自定义压缩提示词，并获取简洁的摘要/压缩版本。这对于优化 Token 使用和处理后续 AI 任务中的大输入至关重要。

## 1. 后端实现 (`ai_test_platform/main.py`)

我们将添加一个新的 API 端点来处理上下文压缩请求。

### 新增数据模型
- **`CompressRequest`**: 用于定义输入结构的 Pydantic 模型。
  - `content` (str): 需要压缩的长文本。
  - `prompt` (Optional[str]): 自定义压缩指令（默认为通用的摘要提示词）。

### 新增 API 端点
- **`POST /api/compress-context`**:
  - 接收 `CompressRequest`。
  - 调用 `ai_client.compress_context` 执行压缩。
  - 计算并返回：
    - `compressed_content`: 压缩后的文本结果。
    - `original_length`: 输入文本的字符数。
    - `compressed_length`: 输出文本的字符数。
    - `compression_ratio`: 压缩比例（减少的百分比）。

## 2. 前端实现 (`ai_test_platform/templates/index.html`)

我们将向主用户界面添加一个新的功能标签页。

### 新增标签页：“上下文压缩”
- **位置**: 添加到主导航栏（例如在“知识库管理”之后）。
- **布局**:
  - **输入区**: 一个大文本区域，用于粘贴长上下文。
  - **配置区**: 一个可选的输入框，用于“自定义压缩提示词”（例如：“提取关键 API 定义”）。
  - **操作区**: “压缩上下文”按钮。
  - **输出区**:
    - **统计信息**: 显示“原始大小”、“压缩后大小”和“压缩率”的徽章。
    - **结果区域**: 显示压缩后文本的只读文本区域，附带“复制”按钮。

### 交互逻辑 (JavaScript)
- **`compressContext()`**:
  - 收集输入文本和提示词。
  - 调用 `/api/compress-context` 端点。
  - 更新 UI 显示结果和统计信息。
  - 处理加载状态和错误提示。

## 3. 集成与验证

- **手动验证**:
  - 启动应用程序。
  - 导航至新的“上下文压缩”标签页。
  - 粘贴一段长文本（例如长篇需求文档）。
  - 点击“压缩”，验证输出是否为摘要版本。
  - 检查统计信息计算是否正确。
